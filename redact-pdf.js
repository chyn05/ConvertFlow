document.addEventListener('DOMContentLoaded',function(){const input=document.getElementById('redactPdfInput');const coords=document.getElementById('redactCoords');const btn=document.getElementById('applyRedactBtn');const dl=document.getElementById('redactDownload');const status=document.getElementById('redactStatus');btn&&btn.addEventListener('click',async()=>{if(!input.files[0]) return status.textContent='Select PDF';const lines=coords.value.trim().split('\n').map(s=>s.trim()).filter(Boolean);if(lines.length===0)return status.textContent='Enter coordinates';status.textContent='Applying redaction...';try{const { PDFDocument, rgb }=PDFLib;const arr=await input.files[0].arrayBuffer();const src=await PDFDocument.load(arr);const out=await PDFDocument.create();for(let i=0;i<src.getPageCount();i++){const [copied]=await out.copyPages(src,[i]);out.addPage(copied);} // apply redactions by drawing rectangles on pages
for(const line of lines){const parts=line.split(':');if(parts.length<2) continue;const p=parseInt(parts[0],10);const vals=parts[1].split(',').map(x=>parseFloat(x));if(vals.length<4) continue;const page = out.getPage(p); page.drawRectangle({x:vals[0],y:vals[1],width:vals[2],height:vals[3],color:rgb(0,0,0)}); }const bytes=await out.save();dl.href=URL.createObjectURL(new Blob([bytes],{type:'application/pdf'}));dl.style.display='inline-block';status.textContent='Done';}catch(e){console.error(e);status.textContent='Error';}});});