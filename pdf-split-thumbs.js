const pdfjsLib=window['pdfjsLib'];pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';document.addEventListener('DOMContentLoaded',function(){const input=document.getElementById('splitPdfInput');const pagesArea=document.getElementById('pagesArea');const extractBtn=document.getElementById('extractSelectedBtn');const rangeBtn=document.getElementById('extractRangeBtn');const rangeInput=document.getElementById('rangeInput');const status=document.getElementById('splitStatus');const downloadArea=document.getElementById('splitDownloadArea');let loadedPdf=null;input&&input.addEventListener('change',async(e)=>{const file=e.target.files[0];if(!file) return;pagesArea.innerHTML='Loading...';status.textContent='';downloadArea.innerHTML='';const data=await file.arrayBuffer();loadedPdf=await pdfjsLib.getDocument({data}).promise;const num=loadedPdf.numPages;pagesArea.innerHTML='';for(let i=1;i<=num;i++){const canvas=document.createElement('canvas');canvas.className='preview-thumb';const wrapper=document.createElement('div');wrapper.className='list-item';const checkbox=document.createElement('input');checkbox.type='checkbox';checkbox.dataset.page=i-1;const caption=document.createElement('div');caption.textContent='Page '+i;wrapper.appendChild(canvas);wrapper.appendChild(checkbox);wrapper.appendChild(caption);pagesArea.appendChild(wrapper);const page=await loadedPdf.getPage(i);const viewport=page.getViewport({scale:1});const scale=Math.min(120/viewport.width,160/viewport.height);const rv=page.getViewport({scale});canvas.width=rv.width;canvas.height=rv.height;await page.render({canvasContext:canvas.getContext('2d'),viewport:rv}).promise;} });extractBtn&&extractBtn.addEventListener('click',async()=>{if(!loadedPdf) return status.textContent='Load PDF';const checked=Array.from(document.querySelectorAll('#pagesArea input[type=checkbox]')).filter(i=>i.checked).map(i=>parseInt(i.dataset.page));if(checked.length===0) return status.textContent='Select pages';status.textContent='Creating...';const { PDFDocument }=PDFLib;const arr=await input.files[0].arrayBuffer();const src=await PDFDocument.load(arr);const out=await PDFDocument.create();const copied=await out.copyPages(src,checked);copied.forEach(p=>out.addPage(p));const bytes=await out.save();const blob=new Blob([bytes],{type:'application/pdf'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='extracted.pdf';a.textContent='Download extracted.pdf';a.className='download-link';downloadArea.appendChild(a);status.textContent='Done';});rangeBtn&&rangeBtn.addEventListener('click',async()=>{if(!loadedPdf) return status.textContent='Load PDF';const txt=rangeInput.value.trim();if(!txt) return status.textContent='Enter range';const parts=txt.split(',').map(s=>s.trim()).filter(Boolean);const pages=[];for(const p of parts){if(p.includes('-')){const [a,b]=p.split('-').map(x=>parseInt(x,10));for(let k=a;k<=b;k++) pages.push(k-1);}else{const n=parseInt(p,10);if(!isNaN(n)) pages.push(n-1);} }if(pages.length===0) return status.textContent='No pages';status.textContent='Creating...';const { PDFDocument }=PDFLib;const arr=await input.files[0].arrayBuffer();const src=await PDFDocument.load(arr);const out=await PDFDocument.create();const copied=await out.copyPages(src,pages);copied.forEach(p=>out.addPage(p));const bytes=await out.save();const blob=new Blob([bytes],{type:'application/pdf'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='range-extract.pdf';a.textContent='Download range-extract.pdf';a.className='download-link';downloadArea.appendChild(a);status.textContent='Done';});});