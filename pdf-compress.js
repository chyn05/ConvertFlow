document.addEventListener('DOMContentLoaded',function(){const input=document.getElementById('pdfCompressInput');const btn=document.getElementById('pdfCompressButton');const status=document.getElementById('pdfCompressStatus');const dl=document.getElementById('pdfCompressDownload');const canvas=document.createElement('canvas');btn&&btn.addEventListener('click',async()=>{if(!input.files[0]) return alert('Select PDF');status.textContent='Compressing...';try{const arr=await input.files[0].arrayBuffer();const pdf=await pdfjsLib.getDocument({data:arr}).promise;const { jsPDF }=window.jspdf;let out=null;for(let p=1;p<=pdf.numPages;p++){const page=await pdf.getPage(p);const vp=page.getViewport({scale:1.5});canvas.width=vp.width;canvas.height=vp.height;await page.render({canvasContext:canvas.getContext('2d'),viewport:vp}).promise;const dataUrl=canvas.toDataURL('image/jpeg',0.7); if(!out){ out=new jsPDF({unit:'pt',format:[595.28,(vp.height/vp.width)*595.28]}); out.addImage(dataUrl,'JPEG',0,0,out.internal.pageSize.getWidth(),out.internal.pageSize.getHeight()); } else { out.addPage(); out.addImage(dataUrl,'JPEG',0,0,out.internal.pageSize.getWidth(),out.internal.pageSize.getHeight()); } } const blob=out.output('blob'); dl.href=URL.createObjectURL(blob); dl.style.display='inline-block'; status.textContent='Done';}catch(e){console.error(e);status.textContent='Error';}});});