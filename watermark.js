document.addEventListener('DOMContentLoaded',function(){const input=document.getElementById('watermarkInput');const btn=document.getElementById('applyWmBtn');const txt=document.getElementById('wmText');const dl=document.getElementById('wmDownload');const status=document.getElementById('wmStatus');btn&&btn.addEventListener('click',async()=>{if(!input.files[0]) return status.textContent='Select PDF';status.textContent='Applying watermark...';try{const { PDFDocument, rgb, degrees }=PDFLib;const arr=await input.files[0].arrayBuffer();const src=await PDFDocument.load(arr);const out=await PDFDocument.create();for(let i=0;i<src.getPageCount();i++){const [copied]=await out.copyPages(src,[i]);const page=copied;const { width, height }=page.getSize(); page.drawText(txt.value||'ConvertFlow',{x:width/4,y:height/2,size:50,color:rgb(0.8,0.1,0.1),rotate:degrees(-45),opacity:0.2}); out.addPage(page);}const bytes=await out.save();dl.href=URL.createObjectURL(new Blob([bytes],{type:'application/pdf'}));dl.style.display='inline-block';status.textContent='Done';}catch(e){console.error(e);status.textContent='Error';}});});